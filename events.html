<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - AlumniConnect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-graduation-cap me-2"></i>AlumniConnect
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="directory.html">Directory</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="events.html">Events</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="jobs.html">Jobs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="success-stories.html">Success Stories</a>
                    </li>
                </ul>
                <div class="d-flex nav-buttons">
                    <a href="login.html" class="btn btn-outline-primary me-2">Login</a>
                    <a href="register.html" class="btn btn-primary">Register</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Events Page -->
    <div class="container py-5">
        <!-- Header Section (centered) -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="section-title">Events</h2>
                <p class="text-muted">Join our alumni community at these exciting events</p>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" id="searchEvents" class="form-control" placeholder="Search events...">
                    <button class="btn btn-outline-secondary" type="button" onclick="searchEvents()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-3">
                <select id="eventFilter" class="form-select" onchange="filterEvents()">
                    <option value="all">All Events</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="past">Past Events</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="eventSort" class="form-select" onchange="sortEvents()">
                    <option value="datetime">Sort by Date</option>
                    <option value="title">Sort by Title</option>
                    <option value="attendees">Sort by Attendees</option>
                </select>
            </div>
        </div>

        <!-- Events Content -->
        <div id="eventsContent">
            <div id="upcoming" class="row mb-5"></div>
            <div id="past" class="row mb-5"></div>
        </div>

        <!-- Pagination -->
        <nav aria-label="Events pagination" class="mt-4">
            <ul id="eventsPagination" class="pagination justify-content-center"></ul>
        </nav>
    </div>

    <!-- Create/Edit Event Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalTitle">Create Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Event Title *</label>
                            <input type="text" class="form-control" id="eventTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="eventLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation" name="location">
                        </div>
                        <div class="mb-3">
                            <label for="eventDatetime" class="form-label">Date & Time *</label>
                            <input type="datetime-local" class="form-control" id="eventDatetime" name="datetime" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventImage" class="form-label">Event Image</label>
                            <input type="file" class="form-control" id="eventImage" name="image" accept="image/*">
                        </div>
                        <div id="eventImagePreview" class="mb-3 d-none">
                            <img id="previewImg" src="" alt="Preview" class="img-thumbnail" style="max-width: 200px;">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEvent()">Save Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Detail Modal -->
    <div class="modal fade" id="eventDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventDetailTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="eventDetailContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="registerBtn" type="button" class="btn btn-primary d-none" onclick="toggleRegistration(this.dataset.eventId)">
                        <span id="registerBtnText">Register</span>
                    </button>
                    <button id="editEventBtn" type="button" class="btn btn-warning d-none" onclick="editEvent(this.dataset.eventId)">
                        <i class="fas fa-edit me-2"></i>Edit
                    </button>
                    <button id="deleteEventBtn" type="button" class="btn btn-danger d-none" onclick="deleteEvent(this.dataset.eventId)">
                        <i class="fas fa-trash me-2"></i>Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 mb-4">
                    <h5>AlumniConnect</h5>
                    <p>Reconnect. Network. Thrive.</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="text-white"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-white text-decoration-none">Home</a></li>
                        <li><a href="directory.html" class="text-white text-decoration-none">Directory</a></li>
                        <li><a href="events.html" class="text-white text-decoration-none">Events</a></li>
                        <li><a href="jobs.html" class="text-white text-decoration-none">Jobs</a></li>
                        <li><a href="success-stories.html" class="text-white text-decoration-none">Success Stories</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-4">
                    <h5>Resources</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white text-decoration-none">FAQ</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Contact Us</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Privacy Policy</a></li>
                        <li><a href="#" class="text-white text-decoration-none">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-4">
                    <h5>Contact Info</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-map-marker-alt me-2"></i> 123 University Ave, City, State</li>
                        <li class="mb-2"><i class="fas fa-phone me-2"></i> (555) 123-4567</li>
                        <li class="mb-2"><i class="fas fa-envelope me-2"></i> alumni@university.edu</li>
                    </ul>
                </div>
            </div>
            <hr class="my-4 bg-light">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 AlumniConnect. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script>
        let currentUser = null;
        let currentEvents = [];
        let currentPage = 1;
        let totalPages = 1;
        let currentFilter = 'all';
        let currentSearch = '';
        let currentSort = 'datetime';

        function eventCard(ev) {
            const isPast = new Date(ev.datetime) < new Date();
            const isRegistered = currentUser && ev.attendees && ev.attendees.includes(currentUser._id);
            const isAdmin = currentUser && currentUser.roles && currentUser.roles.includes('admin');
            
            return `
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 shadow-sm event-card">
                    ${ev.imageUrl ? `
                        <img src="${ev.imageUrl.startsWith('http') ? ev.imageUrl : AlumniApp.API_BASE.replace('/api', '') + ev.imageUrl}" 
                             class="card-img-top" style="height: 200px; object-fit: cover;" alt="${ev.title}">
                    ` : `
                        <div class="card-img-top bg-primary d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-calendar-alt text-white" style="font-size: 3rem;"></i>
                        </div>
                    `}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${ev.title}</h5>
                        <p class="card-text text-muted small flex-grow-1">${ev.description || 'No description available.'}</p>
                        <div class="mb-3">
                            <p class="mb-1"><i class="fas fa-map-marker-alt text-primary me-2"></i> ${ev.location || 'TBA'}</p>
                            <p class="mb-1"><i class="fas fa-clock text-primary me-2"></i> ${new Date(ev.datetime).toLocaleString()}</p>
                            <p class="mb-1"><i class="fas fa-users text-primary me-2"></i> ${(ev.attendees || []).length} attending</p>
                        </div>
                        <div class="d-flex gap-2 mt-auto">
                            <button class="btn btn-outline-primary btn-sm flex-grow-1" onclick="showEventDetail('${ev._id}')">
                                <i class="fas fa-info-circle me-1"></i>Details
                            </button>
                            ${!isPast && !isRegistered ? `
                                <button class="btn btn-primary btn-sm" onclick="toggleRegistration('${ev._id}')">
                                    <i class="fas fa-user-plus me-1"></i>Register
                                </button>
                            ` : isRegistered ? `
                                <button class="btn btn-success btn-sm" onclick="toggleRegistration('${ev._id}')">
                                    <i class="fas fa-check me-1"></i>Registered
                                </button>
                            ` : ''}
                        </div>
                        ${isAdmin ? `
                            <div class="mt-2 d-flex gap-1">
                                <button class="btn btn-warning btn-sm flex-grow-1" onclick="editEvent('${ev._id}')">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteEvent('${ev._id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            </div>`;
        }

        async function loadUser() {
            try {
                const response = await AlumniApp.apiFetch('/auth/me');
                currentUser = response.user;
                
                // Show create button for admins (if the button exists on this page)
                const createBtn = document.getElementById('createEventBtn');
                if (createBtn && currentUser && currentUser.roles && currentUser.roles.includes('admin')) {
                    createBtn.classList.remove('d-none');
                }
            } catch (error) {
                console.error('Failed to load user data:', error);
                currentUser = null;
            }
        }

        async function loadEvents(page = 1, filter = currentFilter, search = currentSearch, sort = currentSort) {
            const upcomingContainer = document.getElementById('upcoming');
            const pastContainer = document.getElementById('past');
            upcomingContainer.innerHTML = `
                <div class="col-12 text-center text-muted py-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-3">Loading events...</p>
                </div>
            `;
            pastContainer.innerHTML = '';

            try {
                console.log('Loading events...', { page, filter, search, sort });
                
                let url = `/events?page=${page}&limit=12`;
                
                if (filter === 'upcoming') {
                    url += '&upcoming=true';
                } else if (filter === 'past') {
                    url += '&past=true';
                }
                
                // Note: Search and sort would need backend implementation
                // For now, we'll handle client-side filtering
                
                const response = await AlumniApp.apiFetch(url);
                console.log('Events response:', response);
                
                currentEvents = response.items || [];
                currentPage = response.page || 1;
                totalPages = Math.ceil((response.total || 0) / (response.limit || 12));
                
                // Apply client-side search and sort
                if (search) {
                    currentEvents = currentEvents.filter(event => 
                        event.title.toLowerCase().includes(search.toLowerCase()) ||
                        (event.description && event.description.toLowerCase().includes(search.toLowerCase())) ||
                        (event.location && event.location.toLowerCase().includes(search.toLowerCase()))
                    );
                }
                
                if (sort === 'title') {
                    currentEvents.sort((a, b) => a.title.localeCompare(b.title));
                } else if (sort === 'attendees') {
                    currentEvents.sort((a, b) => (b.attendees?.length || 0) - (a.attendees?.length || 0));
                } else {
                    currentEvents.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
                }
                
                displayEvents();
                updatePagination();
                
            } catch (err) {
                console.error('Error loading events:', err);
                upcomingContainer.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Error loading events: ${err.message}
                        </div>
                    </div>
                `;
                pastContainer.innerHTML = '';
            }
        }

        function displayEvents() {
            const upcomingEvents = currentEvents.filter(event => new Date(event.datetime) >= new Date());
            const pastEvents = currentEvents.filter(event => new Date(event.datetime) < new Date());
            
            const upcomingHtml = upcomingEvents.length > 0 ? 
                upcomingEvents.map(eventCard).join('') : 
                '<div class="col-12"><p class="text-muted text-center">No upcoming events found.</p></div>';
            
            const pastHtml = pastEvents.length > 0 ? 
                pastEvents.map(eventCard).join('') : 
                '<div class="col-12"><p class="text-muted text-center">No past events found.</p></div>';
            
            document.getElementById('upcoming').innerHTML = upcomingHtml;
            document.getElementById('past').innerHTML = pastHtml;
        }

        function updatePagination() {
            const pagination = document.getElementById('eventsPagination');
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadEvents(${currentPage - 1}); return false;">Previous</a>
                </li>
            `;
            
            // Page numbers
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                html += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="loadEvents(${i}); return false;">${i}</a>
                    </li>
                `;
            }
            
            // Next button
            html += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="loadEvents(${currentPage + 1}); return false;">Next</a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }

        function searchEvents() {
            currentSearch = document.getElementById('searchEvents').value;
            currentPage = 1;
            loadEvents();
        }

        function filterEvents() {
            currentFilter = document.getElementById('eventFilter').value;
            currentPage = 1;
            loadEvents();
        }

        function sortEvents() {
            currentSort = document.getElementById('eventSort').value;
            loadEvents();
        }

        async function showEventDetail(eventId) {
            try {
                const response = await AlumniApp.apiFetch(`/events/${eventId}`);
                const event = response.event;
                const isPast = new Date(event.datetime) < new Date();
                const isRegistered = currentUser && event.attendees && event.attendees.includes(currentUser._id);
                const isAdmin = currentUser && currentUser.roles && currentUser.roles.includes('admin');
                
                document.getElementById('eventDetailTitle').textContent = event.title;
                
                const content = `
                    <div class="row">
                        ${event.imageUrl ? `
                            <div class="col-md-4 mb-3">
                                <img src="${event.imageUrl.startsWith('http') ? event.imageUrl : AlumniApp.API_BASE.replace('/api', '') + event.imageUrl}" 
                                     class="img-fluid rounded" alt="${event.title}">
                            </div>
                        ` : ''}
                        <div class="${event.imageUrl ? 'col-md-8' : 'col-12'}">
                            <p class="mb-3"><strong>Description:</strong> ${event.description || 'No description available.'}</p>
                            <p class="mb-2"><i class="fas fa-map-marker-alt text-primary me-2"></i> <strong>Location:</strong> ${event.location || 'TBA'}</p>
                            <p class="mb-2"><i class="fas fa-clock text-primary me-2"></i> <strong>Date & Time:</strong> ${new Date(event.datetime).toLocaleString()}</p>
                            <p class="mb-2"><i class="fas fa-users text-primary me-2"></i> <strong>Attendees:</strong> ${(event.attendees || []).length} people registered</p>
                            <p class="mb-2"><i class="fas fa-calendar text-primary me-2"></i> <strong>Created:</strong> ${new Date(event.createdAt).toLocaleDateString()}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('eventDetailContent').innerHTML = content;
                
                // Show/hide buttons based on user permissions and event status
                const registerBtn = document.getElementById('registerBtn');
                const registerBtnText = document.getElementById('registerBtnText');
                const editBtn = document.getElementById('editEventBtn');
                const deleteBtn = document.getElementById('deleteEventBtn');
                
                if (!isPast && currentUser) {
                    registerBtn.classList.remove('d-none');
                    registerBtnText.textContent = isRegistered ? 'Unregister' : 'Register';
                    registerBtn.className = isRegistered ? 'btn btn-outline-danger' : 'btn btn-primary';
                } else {
                    registerBtn.classList.add('d-none');
                }
                
                if (isAdmin) {
                    editBtn.classList.remove('d-none');
                    deleteBtn.classList.remove('d-none');
                } else {
                    editBtn.classList.add('d-none');
                    deleteBtn.classList.add('d-none');
                }
                
                // Store current event ID for actions
                registerBtn.dataset.eventId = eventId;
                editBtn.dataset.eventId = eventId;
                deleteBtn.dataset.eventId = eventId;
                
                new bootstrap.Modal(document.getElementById('eventDetailModal')).show();
                
            } catch (error) {
                console.error('Error loading event details:', error);
                alert('Error loading event details: ' + error.message);
            }
        }

        async function toggleRegistration(eventId) {
            if (!AlumniApp.getToken()) {
                alert('Please login first.');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const event = currentEvents.find(e => e._id === eventId);
                const isRegistered = currentUser && event.attendees && event.attendees.includes(currentUser._id);
                
                if (isRegistered) {
                    await AlumniApp.apiFetch(`/events/${eventId}/unregister`, { method: 'POST' });
                    event.attendees = event.attendees.filter(id => id !== currentUser._id);
                    alert('Successfully unregistered from event.');
                } else {
                    await AlumniApp.apiFetch(`/events/${eventId}/register`, { method: 'POST' });
                    if (!event.attendees) event.attendees = [];
                    event.attendees.push(currentUser._id);
                    alert('Successfully registered for event.');
                }
                
                displayEvents();
                
            } catch (error) {
                console.error('Error toggling registration:', error);
                alert('Error: ' + error.message);
            }
        }

        function showCreateEventModal() {
            if (!currentUser || !currentUser.roles || !currentUser.roles.includes('admin')) {
                alert('Only administrators can create events.');
                return;
            }
            
            document.getElementById('eventModalTitle').textContent = 'Create Event';
            document.getElementById('eventForm').reset();
            document.getElementById('eventImagePreview').classList.add('d-none');
            
            // Remove any existing event ID
            delete document.getElementById('eventForm').dataset.eventId;
            
            new bootstrap.Modal(document.getElementById('eventModal')).show();
        }

        function editEvent(eventId) {
            if (!currentUser || !currentUser.roles || !currentUser.roles.includes('admin')) {
                alert('Only administrators can edit events.');
                return;
            }
            
            const event = currentEvents.find(e => e._id === eventId);
            if (!event) {
                alert('Event not found.');
                return;
            }
            
            document.getElementById('eventModalTitle').textContent = 'Edit Event';
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventDescription').value = event.description || '';
            document.getElementById('eventLocation').value = event.location || '';
            
            // Format datetime for input
            const datetime = new Date(event.datetime);
            const localDatetime = new Date(datetime.getTime() - datetime.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('eventDatetime').value = localDatetime;
            
            // Show existing image if available
            if (event.imageUrl) {
                document.getElementById('previewImg').src = event.imageUrl.startsWith('http') ? event.imageUrl : AlumniApp.API_BASE.replace('/api', '') + event.imageUrl;
                document.getElementById('eventImagePreview').classList.remove('d-none');
            } else {
                document.getElementById('eventImagePreview').classList.add('d-none');
            }
            
            // Store event ID for update
            document.getElementById('eventForm').dataset.eventId = eventId;
            
            new bootstrap.Modal(document.getElementById('eventModal')).show();
        }

        async function saveEvent() {
            if (!currentUser || !currentUser.roles || !currentUser.roles.includes('admin')) {
                alert('Only administrators can save events.');
                return;
            }
            
            const form = document.getElementById('eventForm');
            const formData = new FormData(form);
            
            const eventId = form.dataset.eventId;
            const isEdit = !!eventId;
            
            try {
                let response;
                if (isEdit) {
                    // For PATCH, convert FormData to JSON object
                    const payload = {
                        title: formData.get('title'),
                        description: formData.get('description'),
                        location: formData.get('location'),
                        datetime: new Date(formData.get('datetime')).toISOString()
                    };
                    response = await AlumniApp.apiFetch(`/events/${eventId}`, {
                        method: 'PATCH',
                        body: JSON.stringify(payload)
                    });
                } else {
                    response = await AlumniApp.apiFetch('/events', {
                        method: 'POST',
                        body: formData
                    });
                }
                
                alert(isEdit ? 'Event updated successfully!' : 'Event created successfully!');
                bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
                loadEvents();
                
            } catch (error) {
                console.error('Error saving event:', error);
                alert('Error saving event: ' + error.message);
            }
        }

        async function deleteEvent(eventId) {
            if (!currentUser || !currentUser.roles || !currentUser.roles.includes('admin')) {
                alert('Only administrators can delete events.');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                return;
            }
            
            try {
                await AlumniApp.apiFetch(`/events/${eventId}`, { method: 'DELETE' });
                alert('Event deleted successfully!');
                bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
                loadEvents();
                
            } catch (error) {
                console.error('Error deleting event:', error);
                alert('Error deleting event: ' + error.message);
            }
        }

        // Event listeners
        document.getElementById('eventImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('eventImagePreview').classList.remove('d-none');
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('eventImagePreview').classList.add('d-none');
            }
        });

        document.getElementById('searchEvents').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEvents();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            if (AlumniApp.getToken()) {
                await loadUser();
            }
            await loadEvents();
        });
    </script>
</body>
</html>